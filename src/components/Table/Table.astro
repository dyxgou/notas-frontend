---
import Grades from "./Grades/Grades.tsx";

interface Props {
  subjectId: number;
  course: number;
}

const { subjectId, course } = Astro.props;
---

<main class="bg-white w-full rounded-xl border border-gray-200 overflow-hidden">
  <div
    class="overflow-x-auto"
    id="grades-container"
    data-course={course}
    data-subjectId={subjectId}
  >
    <Grades client:only />
  </div>
</main>

<script>
  import { setCourse, setSubjectId } from "@/store/config";
  import { navigate } from "astro:transitions/client";

  const subjectIdAttr = "data-subjectId";
  const courseAttr = "data-course";
  const tableGradesId = "grades-container";
  const table = document.getElementById(tableGradesId) as HTMLTableElement;

  const subjectId = table.getAttribute(subjectIdAttr);
  const course = table.getAttribute(courseAttr);

  if (!subjectId || !course) {
    navigate("/404");
  }

  document.addEventListener("astro:page-load", async () => {
    setCourse(parseInt(course!));
    setSubjectId(parseInt(subjectId!));
  });
</script>
